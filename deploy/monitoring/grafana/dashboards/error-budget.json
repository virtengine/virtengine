{
  "annotations": { "list": [] },
  "description": "Error Budget and SLO Compliance - Track error budget consumption and SLO status",
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "links": [
    { "asDropdown": true, "icon": "external link", "includeVars": true, "keepTime": true, "tags": ["virtengine"], "title": "VirtEngine Dashboards", "type": "dashboards" }
  ],
  "panels": [
    { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }, "id": 100, "panels": [], "title": "Error Budget Overview", "type": "row" },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "percentage", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 25 }, { "color": "green", "value": 50 }] },
          "unit": "percentunit",
          "max": 1,
          "min": 0
        }
      },
      "gridPos": { "h": 6, "w": 6, "x": 0, "y": 1 },
      "id": 1,
      "options": { "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "showThresholdLabels": false, "showThresholdMarkers": true },
      "targets": [{ "expr": "virtengine_slo_error_budget_remaining_ratio{service=\"chain\"}", "legendFormat": "", "refId": "A" }],
      "title": "Chain Error Budget",
      "type": "gauge"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "percentage", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 25 }, { "color": "green", "value": 50 }] },
          "unit": "percentunit",
          "max": 1,
          "min": 0
        }
      },
      "gridPos": { "h": 6, "w": 6, "x": 6, "y": 1 },
      "id": 2,
      "options": { "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "showThresholdLabels": false, "showThresholdMarkers": true },
      "targets": [{ "expr": "virtengine_slo_error_budget_remaining_ratio{service=\"veid\"}", "legendFormat": "", "refId": "A" }],
      "title": "VEID Error Budget",
      "type": "gauge"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "percentage", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 25 }, { "color": "green", "value": 50 }] },
          "unit": "percentunit",
          "max": 1,
          "min": 0
        }
      },
      "gridPos": { "h": 6, "w": 6, "x": 12, "y": 1 },
      "id": 3,
      "options": { "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "showThresholdLabels": false, "showThresholdMarkers": true },
      "targets": [{ "expr": "virtengine_slo_error_budget_remaining_ratio{service=\"marketplace\"}", "legendFormat": "", "refId": "A" }],
      "title": "Marketplace Error Budget",
      "type": "gauge"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "percentage", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 25 }, { "color": "green", "value": 50 }] },
          "unit": "percentunit",
          "max": 1,
          "min": 0
        }
      },
      "gridPos": { "h": 6, "w": 6, "x": 18, "y": 1 },
      "id": 4,
      "options": { "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "showThresholdLabels": false, "showThresholdMarkers": true },
      "targets": [{ "expr": "virtengine_slo_error_budget_remaining_ratio{service=\"hpc\"}", "legendFormat": "", "refId": "A" }],
      "title": "HPC Error Budget",
      "type": "gauge"
    },
    { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 7 }, "id": 101, "panels": [], "title": "SLO Compliance", "type": "row" },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 0.995 }, { "color": "green", "value": 0.999 }] },
          "unit": "percentunit"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 0, "y": 8 },
      "id": 5,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "sum_over_time(up{job=\"virtengine-node\"}[28d]) / count_over_time(up{job=\"virtengine-node\"}[28d])", "legendFormat": "", "refId": "A" }],
      "title": "Node Uptime (28d)",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 0.99 }, { "color": "green", "value": 0.995 }] },
          "unit": "percentunit"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 4, "y": 8 },
      "id": 6,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "sum(rate(veid_scoring_requests_total{status=\"success\"}[28d])) / sum(rate(veid_scoring_requests_total[28d]))", "legendFormat": "", "refId": "A" }],
      "title": "VEID Success Rate (28d)",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 0.99 }, { "color": "green", "value": 0.995 }] },
          "unit": "percentunit"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 8 },
      "id": 7,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "sum(rate(market_orders_fulfilled_total[28d])) / sum(rate(market_orders_created_total[28d]))", "legendFormat": "", "refId": "A" }],
      "title": "Order Fulfillment Rate (28d)",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 0.95 }, { "color": "green", "value": 0.99 }] },
          "unit": "percentunit"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 8 },
      "id": 8,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "1 - (sum(rate(hpc_jobs_failed_total[28d])) / sum(rate(hpc_jobs_total[28d])))", "legendFormat": "", "refId": "A" }],
      "title": "HPC Job Success Rate (28d)",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 5 }, { "color": "red", "value": 6 }] },
          "unit": "s"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 8 },
      "id": 9,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "histogram_quantile(0.99, sum(rate(tendermint_consensus_block_interval_seconds_bucket[28d])) by (le))", "legendFormat": "", "refId": "A" }],
      "title": "Block Time P99 (28d)",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 1 }, { "color": "red", "value": 2 }] },
          "unit": "s"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 8 },
      "id": 10,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "histogram_quantile(0.95, sum(rate(grpc_server_handling_seconds_bucket{grpc_type=\"unary\"}[28d])) by (le))", "legendFormat": "", "refId": "A" }],
      "title": "API Latency P95 (28d)",
      "type": "stat"
    },
    { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 12 }, "id": 102, "panels": [], "title": "Error Budget Burn Rate", "type": "row" },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisLabel": "Burn Rate (x sustainable)", "axisPlacement": "auto", "drawStyle": "line", "fillOpacity": 10, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "line" } },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 2 }, { "color": "red", "value": 5 }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 13 },
      "id": 11,
      "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "targets": [
        { "expr": "(rate(virtengine_slo_errors_total{service=\"chain\"}[1h]) / rate(virtengine_slo_requests_total{service=\"chain\"}[1h])) / (1 - 0.9995)", "legendFormat": "Chain", "refId": "A" },
        { "expr": "(rate(virtengine_slo_errors_total{service=\"veid\"}[1h]) / rate(virtengine_slo_requests_total{service=\"veid\"}[1h])) / (1 - 0.995)", "legendFormat": "VEID", "refId": "B" },
        { "expr": "(rate(virtengine_slo_errors_total{service=\"marketplace\"}[1h]) / rate(virtengine_slo_requests_total{service=\"marketplace\"}[1h])) / (1 - 0.995)", "legendFormat": "Marketplace", "refId": "C" }
      ],
      "title": "Error Budget Burn Rate (1h window)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisLabel": "", "axisPlacement": "auto", "drawStyle": "line", "fillOpacity": 10, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" } },
          "unit": "percentunit"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 13 },
      "id": 12,
      "options": { "legend": { "calcs": ["mean", "min"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "targets": [
        { "expr": "virtengine_slo_error_budget_remaining_ratio{service=\"chain\"}", "legendFormat": "Chain", "refId": "A" },
        { "expr": "virtengine_slo_error_budget_remaining_ratio{service=\"veid\"}", "legendFormat": "VEID", "refId": "B" },
        { "expr": "virtengine_slo_error_budget_remaining_ratio{service=\"marketplace\"}", "legendFormat": "Marketplace", "refId": "C" },
        { "expr": "virtengine_slo_error_budget_remaining_ratio{service=\"hpc\"}", "legendFormat": "HPC", "refId": "D" }
      ],
      "title": "Error Budget Remaining Over Time",
      "type": "timeseries"
    },
    { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 21 }, "id": 103, "panels": [], "title": "SLO Details", "type": "row" },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": { "align": "auto", "displayMode": "auto", "filterable": true, "inspect": true },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Status" }, "properties": [{ "id": "custom.displayMode", "value": "color-background" }, { "id": "thresholds", "value": { "mode": "absolute", "steps": [{ "color": "red", "value": null }, { "color": "green", "value": 1 }] } }] },
          { "matcher": { "id": "byName", "options": "Compliance" }, "properties": [{ "id": "unit", "value": "percentunit" }] }
        ]
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 22 },
      "id": 13,
      "options": { "footer": { "enablePagination": true, "fields": "", "reducer": ["sum"], "show": false }, "showHeader": true },
      "targets": [
        { "expr": "virtengine_slo_info", "format": "table", "instant": true, "legendFormat": "", "refId": "A" }
      ],
      "title": "SLO Status Table",
      "transformations": [
        { "id": "organize", "options": { "excludeByName": { "Time": true, "__name__": true }, "indexByName": {}, "renameByName": { "slo_id": "SLO ID", "service": "Service", "target": "Target", "current": "Current", "status": "Status" } } }
      ],
      "type": "table"
    }
  ],
  "refresh": "1m",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["virtengine", "slo", "error-budget"],
  "templating": { "list": [] },
  "time": { "from": "now-7d", "to": "now" },
  "timepicker": {},
  "timezone": "browser",
  "title": "VirtEngine Error Budget & SLO",
  "uid": "error-budget",
  "version": 1
}
