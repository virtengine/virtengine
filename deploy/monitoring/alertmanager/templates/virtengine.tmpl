{{ define "slack.virtengine.title" -}}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .CommonLabels.alertname }}
{{- end }}

{{ define "slack.virtengine.text" -}}
{{ range .Alerts }}
*Alert:* {{ .Annotations.summary }}
*Description:* {{ .Annotations.description }}
*Severity:* {{ .Labels.severity }}
*Service:* {{ .Labels.service }}
{{ if .Annotations.runbook_url }}*Runbook:* {{ .Annotations.runbook_url }}{{ end }}
{{ if .Annotations.dashboard_url }}*Dashboard:* {{ .Annotations.dashboard_url }}{{ end }}
{{ if .Annotations.impact }}*Impact:* {{ .Annotations.impact }}{{ end }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ end }}
{{- end }}

{{ define "email.virtengine.subject" -}}
[{{ .Status | toUpper }}] {{ .CommonLabels.alertname }} - {{ .CommonLabels.service }}
{{- end }}

{{ define "email.virtengine.html" -}}
<!DOCTYPE html>
<html>
<head>
<style>
body { font-family: Arial, sans-serif; }
.alert { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
.firing { border-left: 4px solid #dc3545; }
.resolved { border-left: 4px solid #28a745; }
.critical { background-color: #f8d7da; }
.warning { background-color: #fff3cd; }
.info { background-color: #d1ecf1; }
.label { font-weight: bold; }
.runbook { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 3px; }
</style>
</head>
<body>
<h2>VirtEngine Alert Notification</h2>
{{ range .Alerts }}
<div class="alert {{ .Status }} {{ .Labels.severity }}">
  <h3>{{ .Annotations.summary }}</h3>
  <p><span class="label">Description:</span> {{ .Annotations.description }}</p>
  <p><span class="label">Severity:</span> {{ .Labels.severity }}</p>
  <p><span class="label">Service:</span> {{ .Labels.service }}</p>
  <p><span class="label">Status:</span> {{ .Status }}</p>
  {{ if .Annotations.impact }}
  <p><span class="label">Impact:</span> {{ .Annotations.impact }}</p>
  {{ end }}
  {{ if .Annotations.runbook_url }}
  <div class="runbook">
    <span class="label">Runbook:</span> <a href="{{ .Annotations.runbook_url }}">{{ .Annotations.runbook_url }}</a>
  </div>
  {{ end }}
  <p><small>Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}</small></p>
</div>
{{ end }}
</body>
</html>
{{- end }}

{{ define "pagerduty.virtengine.description" -}}
{{ .CommonAnnotations.summary }}
Service: {{ .CommonLabels.service }}
Severity: {{ .CommonLabels.severity }}
{{ if .CommonAnnotations.impact }}Impact: {{ .CommonAnnotations.impact }}{{ end }}
{{- end }}

{{ define "pagerduty.virtengine.client_url" -}}
{{ .ExternalURL }}/#/alerts?receiver={{ .Receiver | urlquery }}
{{- end }}
