{{- if .Values.munge.enabled }}
{{- if not .Values.munge.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "slurm-cluster.munge.secretName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "slurm-cluster.labels" . | nindent 4 }}
    app.kubernetes.io/component: munge
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-weight": "-10"
type: Opaque
data:
  {{- if .Values.munge.key }}
  {{ .Values.munge.secretKeyName }}: {{ .Values.munge.key }}
  {{- else }}
  # Auto-generated munge key (512 bytes of random data, base64 encoded)
  {{ .Values.munge.secretKeyName }}: {{ randAlphaNum 512 | b64enc | quote }}
  {{- end }}
{{- end }}
---
{{- if .Values.database.enabled }}
{{- if not .Values.database.config.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "slurm-cluster.database.secretName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "slurm-cluster.labels" . | nindent 4 }}
    app.kubernetes.io/component: database
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-weight": "-10"
type: Opaque
data:
  {{- if .Values.database.config.password }}
  {{ .Values.database.config.secretPasswordKey }}: {{ .Values.database.config.password | b64enc | quote }}
  {{- else }}
  {{ .Values.database.config.secretPasswordKey }}: {{ randAlphaNum 32 | b64enc | quote }}
  {{- end }}
{{- end }}
{{- end }}
---
{{- if .Values.mariadb.enabled }}
{{- if not .Values.mariadb.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "slurm-cluster.mariadb.secretName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "slurm-cluster.labels" . | nindent 4 }}
    app.kubernetes.io/component: mariadb
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-weight": "-10"
type: Opaque
data:
  {{- if .Values.mariadb.rootPassword }}
  {{ .Values.mariadb.secretRootPasswordKey }}: {{ .Values.mariadb.rootPassword | b64enc | quote }}
  {{- else }}
  {{ .Values.mariadb.secretRootPasswordKey }}: {{ randAlphaNum 32 | b64enc | quote }}
  {{- end }}
{{- end }}
{{- end }}
{{- end }}
