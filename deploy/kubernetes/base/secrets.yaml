# External Secrets references
# These pull secrets from Vault/AWS Secrets Manager
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: virtengine-node-secrets
  namespace: virtengine
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault-backend
  target:
    name: virtengine-node-secrets
    creationPolicy: Owner
  data:
    - secretKey: node-key
      remoteRef:
        key: secret/virtengine/node
        property: node-key
    - secretKey: priv-validator-key
      remoteRef:
        key: secret/virtengine/node
        property: priv-validator-key
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: provider-daemon-secrets
  namespace: virtengine
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault-backend
  target:
    name: provider-daemon-secrets
    creationPolicy: Owner
  data:
    - secretKey: provider-key
      remoteRef:
        key: secret/virtengine/provider
        property: provider-key
    - secretKey: wallet-mnemonic
      remoteRef:
        key: secret/virtengine/provider
        property: wallet-mnemonic
---
# Database credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: database-credentials
  namespace: virtengine
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secrets-manager
  target:
    name: database-credentials
    creationPolicy: Owner
  dataFrom:
    - extract:
        key: virtengine/database
