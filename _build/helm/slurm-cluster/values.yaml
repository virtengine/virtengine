# SLURM Cluster Helm Chart Values
# VE-502: Decentralized SLURM cluster deployment via Kubernetes

# Cluster configuration
cluster:
  # Cluster name for VirtEngine registration
  name: "virtengine-hpc-cluster"
  
  # VirtEngine provider address
  providerAddress: ""
  
  # Geographic region
  region: "us-east-1"
  
  # Datacenter identifier
  datacenter: "dc1"

# SLURM Controller (slurmctld)
controller:
  enabled: true
  replicas: 1
  
  image:
    repository: virtengine/slurm-controller
    tag: "23.02.7"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "2"
      memory: "4Gi"
  
  persistence:
    enabled: true
    size: "10Gi"
    storageClass: ""
  
  service:
    type: ClusterIP
    port: 6817

# SLURM Database (slurmdbd)
database:
  enabled: true
  
  image:
    repository: virtengine/slurm-database
    tag: "23.02.7"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: "250m"
      memory: "512Mi"
    limits:
      cpu: "1"
      memory: "2Gi"
  
  persistence:
    enabled: true
    size: "20Gi"
    storageClass: ""
  
  # MySQL/MariaDB backend
  mysql:
    enabled: true
    rootPassword: ""  # Set via secret
    database: "slurm_acct_db"
    user: "slurm"
    password: ""  # Set via secret

# SLURM Compute Nodes (slurmd)
compute:
  enabled: true
  replicas: 4
  
  image:
    repository: virtengine/slurm-compute
    tag: "23.02.7"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: "4"
      memory: "16Gi"
    limits:
      cpu: "16"
      memory: "64Gi"
  
  # GPU support
  gpu:
    enabled: false
    type: "nvidia.com/gpu"
    count: 0
  
  # Node features for SLURM
  features: []
  
  # Toleration for dedicated HPC nodes
  tolerations: []
  
  nodeSelector: {}
  
  affinity: {}

# SLURM Partitions configuration
partitions:
  - name: default
    nodes: "node[001-004]"
    default: "YES"
    maxTime: "INFINITE"
    state: "UP"
  
  - name: gpu
    nodes: "gpu[001-002]"
    default: "NO"
    maxTime: "7-00:00:00"
    state: "UP"
    features: "gpu"

# Munge authentication
munge:
  enabled: true
  secretName: ""  # Use existing secret or generate
  
  image:
    repository: virtengine/munge
    tag: "0.5.15"
    pullPolicy: IfNotPresent

# VirtEngine integration
virtengine:
  # Enable on-chain registration
  registration:
    enabled: true
    # Chain RPC endpoint
    chainRPC: "http://virtengine-chain:26657"
  
  # Provider daemon sidecar for job reporting
  providerDaemon:
    enabled: true
    image:
      repository: virtengine/provider-daemon
      tag: "latest"
      pullPolicy: IfNotPresent
    
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"

# Monitoring
monitoring:
  enabled: false
  prometheus:
    enabled: false
    serviceMonitor:
      enabled: false
      interval: "30s"

# Security
security:
  # Pod security context
  podSecurityContext:
    fsGroup: 1000
  
  # Container security context
  securityContext:
    runAsUser: 1000
    runAsGroup: 1000
    runAsNonRoot: true

# Service Account
serviceAccount:
  create: true
  name: ""
  annotations: {}

# Networking
network:
  # Use host network for SLURM communication
  hostNetwork: false
  
  # DNS policy
  dnsPolicy: ClusterFirst

# Resilience
resilience:
  # Pod disruption budget
  podDisruptionBudget:
    enabled: true
    minAvailable: 1
  
  # Automatic node replacement
  autoReplace:
    enabled: true
    unhealthyAfterSeconds: 300
