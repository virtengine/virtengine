syntax = "proto3";

package virtengine.oracle.v1;

import "virtengine/oracle/v1/prices.proto";
import "gogoproto/gogo.proto";
import "cosmos_proto/cosmos.proto";

option go_package = "github.com/virtengine/virtengine/sdk/go/node/oracle/v1";

// EventPriceData is emitted when new price data is added to the oracle
message EventPriceData {
  // source is the address of the price source (oracle provider)
  string source = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (gogoproto.jsontag)   = "source",
    (gogoproto.moretags)  = "yaml:\"source\""
  ];

  // id identifies the price pair (denom and base_denom)
  DataID id = 2 [
    (gogoproto.nullable) = false,
    (gogoproto.jsontag)  = "id",
    (gogoproto.moretags) = "yaml:\"id\""
  ];

  // data contains the price value and timestamp
  PriceDataState data = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.jsontag)  = "data",
    (gogoproto.moretags) = "yaml:\"data\""
  ];
}

// EventPriceStaleWarning is emitted when price has not been updated and is about to become stale
message EventPriceStaleWarning {
  // source is the address of the price source
  string source = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (gogoproto.jsontag)   = "source",
    (gogoproto.moretags)  = "yaml:\"source\""
  ];

  // id identifies the price pair
  DataID id = 2 [
    (gogoproto.nullable) = false,
    (gogoproto.jsontag)  = "id",
    (gogoproto.moretags) = "yaml:\"id\""
  ];

  // last_height is the block height when the price was last updated
  int64 last_height = 3 [
    (gogoproto.jsontag)  = "last_height",
    (gogoproto.moretags) = "yaml:\"last_height\""
  ];

  // blocks_to_stall is the number of blocks until the price becomes stale
  int64 blocks_to_stall = 4 [
    (gogoproto.jsontag)  = "blocks_to_stall",
    (gogoproto.moretags) = "yaml:\"blocks_to_stall\""
  ];
}

// EventPriceStaled is emitted when a price has become stale
message EventPriceStaled {
  // source is the address of the price source
  string source = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (gogoproto.jsontag)   = "source",
    (gogoproto.moretags)  = "yaml:\"source\""
  ];

  // id identifies the price pair
  DataID id = 2 [
    (gogoproto.nullable) = false,
    (gogoproto.jsontag)  = "id",
    (gogoproto.moretags) = "yaml:\"id\""
  ];

  // last_height is the block height when the price was last updated before becoming stale
  int64 last_height = 3 [
    (gogoproto.jsontag)  = "last_height",
    (gogoproto.moretags) = "yaml:\"last_height\""
  ];
}

// EventPriceRecovered is emitted when a stale price has started receiving updates again
message EventPriceRecovered {
  // source is the address of the price source
  string source = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (gogoproto.jsontag)   = "source",
    (gogoproto.moretags)  = "yaml:\"source\""
  ];

  // id identifies the price pair
  DataID id = 2 [
    (gogoproto.nullable) = false,
    (gogoproto.jsontag)  = "id",
    (gogoproto.moretags) = "yaml:\"id\""
  ];

  // height is the block height when the price recovery was detected
  int64 height = 3 [
    (gogoproto.jsontag)  = "height",
    (gogoproto.moretags) = "yaml:\"height\""
  ];
}
