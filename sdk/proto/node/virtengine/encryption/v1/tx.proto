syntax = "proto3";
package virtengine.encryption.v1;

import "gogoproto/gogo.proto";
import "cosmos_proto/cosmos.proto";
import "cosmos/msg/v1/msg.proto";
import "amino/amino.proto";

option go_package = "github.com/virtengine/virtengine/sdk/go/node/encryption/v1";

// Msg defines the encryption Msg service
service Msg {
  option (cosmos.msg.v1.service) = true;

  // RegisterRecipientKey registers a new recipient public key
  rpc RegisterRecipientKey(MsgRegisterRecipientKey) returns (MsgRegisterRecipientKeyResponse);

  // RevokeRecipientKey revokes an existing recipient public key
  rpc RevokeRecipientKey(MsgRevokeRecipientKey) returns (MsgRevokeRecipientKeyResponse);

  // UpdateKeyLabel updates the label of an existing recipient key
  rpc UpdateKeyLabel(MsgUpdateKeyLabel) returns (MsgUpdateKeyLabelResponse);

  // RotateKey rotates a recipient key with a new public key
  rpc RotateKey(MsgRotateKey) returns (MsgRotateKeyResponse);
}

// MsgRegisterRecipientKey is the message for registering a recipient public key
message MsgRegisterRecipientKey {
  option (gogoproto.equal) = false;
  option (cosmos.msg.v1.signer) = "sender";
  option (amino.name) = "encryption/MsgRegisterRecipientKey";

  // Sender is the account registering the key (must match the key owner)
  string sender = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (gogoproto.jsontag) = "sender",
    (gogoproto.moretags) = "yaml:\"sender\""
  ];

  // PublicKey is the X25519 public key bytes (32 bytes)
  bytes public_key = 2 [
    (gogoproto.jsontag) = "public_key",
    (gogoproto.moretags) = "yaml:\"public_key\""
  ];

  // AlgorithmID specifies which algorithm this key is for
  string algorithm_id = 3 [
    (gogoproto.jsontag) = "algorithm_id",
    (gogoproto.moretags) = "yaml:\"algorithm_id\""
  ];

  // Label is an optional human-readable label for the key
  string label = 4 [
    (gogoproto.jsontag) = "label,omitempty",
    (gogoproto.moretags) = "yaml:\"label\""
  ];
}

// MsgRegisterRecipientKeyResponse is the response for MsgRegisterRecipientKey
message MsgRegisterRecipientKeyResponse {
  // KeyFingerprint is the fingerprint of the registered key
  string key_fingerprint = 1 [
    (gogoproto.jsontag) = "key_fingerprint",
    (gogoproto.moretags) = "yaml:\"key_fingerprint\""
  ];
}

// MsgRevokeRecipientKey is the message for revoking a recipient public key
message MsgRevokeRecipientKey {
  option (gogoproto.equal) = false;
  option (cosmos.msg.v1.signer) = "sender";
  option (amino.name) = "encryption/MsgRevokeRecipientKey";

  // Sender is the account revoking the key (must own the key)
  string sender = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (gogoproto.jsontag) = "sender",
    (gogoproto.moretags) = "yaml:\"sender\""
  ];

  // KeyFingerprint is the fingerprint of the key to revoke
  string key_fingerprint = 2 [
    (gogoproto.jsontag) = "key_fingerprint",
    (gogoproto.moretags) = "yaml:\"key_fingerprint\""
  ];
}

// MsgRevokeRecipientKeyResponse is the response for MsgRevokeRecipientKey
message MsgRevokeRecipientKeyResponse {}

// MsgUpdateKeyLabel is the message for updating a key's label
message MsgUpdateKeyLabel {
  option (gogoproto.equal) = false;
  option (cosmos.msg.v1.signer) = "sender";
  option (amino.name) = "encryption/MsgUpdateKeyLabel";

  // Sender is the account updating the key (must own the key)
  string sender = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (gogoproto.jsontag) = "sender",
    (gogoproto.moretags) = "yaml:\"sender\""
  ];

  // KeyFingerprint is the fingerprint of the key to update
  string key_fingerprint = 2 [
    (gogoproto.jsontag) = "key_fingerprint",
    (gogoproto.moretags) = "yaml:\"key_fingerprint\""
  ];

  // Label is the new label for the key
  string label = 3 [
    (gogoproto.jsontag) = "label",
    (gogoproto.moretags) = "yaml:\"label\""
  ];
}

// MsgUpdateKeyLabelResponse is the response for MsgUpdateKeyLabel
message MsgUpdateKeyLabelResponse {}

// MsgRotateKey is the message for rotating a recipient public key
message MsgRotateKey {
  option (gogoproto.equal) = false;
  option (cosmos.msg.v1.signer) = "sender";
  option (amino.name) = "encryption/MsgRotateKey";

  // Sender is the account rotating the key (must own the key or be authority)
  string sender = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (gogoproto.jsontag) = "sender",
    (gogoproto.moretags) = "yaml:\"sender\""
  ];

  // OldKeyFingerprint is the fingerprint of the key to rotate
  string old_key_fingerprint = 2 [
    (gogoproto.jsontag) = "old_key_fingerprint",
    (gogoproto.moretags) = "yaml:\"old_key_fingerprint\""
  ];

  // NewPublicKey is the new public key bytes
  bytes new_public_key = 3 [
    (gogoproto.jsontag) = "new_public_key",
    (gogoproto.moretags) = "yaml:\"new_public_key\""
  ];

  // NewAlgorithmId specifies which algorithm this new key is for (optional, defaults to old key algorithm)
  string new_algorithm_id = 4 [
    (gogoproto.jsontag) = "new_algorithm_id",
    (gogoproto.moretags) = "yaml:\"new_algorithm_id\""
  ];

  // NewLabel is an optional label for the new key
  string new_label = 5 [
    (gogoproto.jsontag) = "new_label,omitempty",
    (gogoproto.moretags) = "yaml:\"new_label\""
  ];

  // Reason is an optional reason for rotation
  string reason = 6 [
    (gogoproto.jsontag) = "reason,omitempty",
    (gogoproto.moretags) = "yaml:\"reason\""
  ];

  // NewKeyTtlSeconds is the TTL to apply to the new key (0 keeps default)
  uint64 new_key_ttl_seconds = 7 [
    (gogoproto.jsontag) = "new_key_ttl_seconds",
    (gogoproto.moretags) = "yaml:\"new_key_ttl_seconds\""
  ];
}

// MsgRotateKeyResponse is the response for MsgRotateKey
message MsgRotateKeyResponse {
  // NewKeyFingerprint is the fingerprint of the new key
  string new_key_fingerprint = 1 [
    (gogoproto.jsontag) = "new_key_fingerprint",
    (gogoproto.moretags) = "yaml:\"new_key_fingerprint\""
  ];
}
