syntax = "proto3";
package virtengine.downtimedetector.v1beta1;

import "gogoproto/gogo.proto";

import "google/api/annotations.proto";
import "google/protobuf/duration.proto";

import "virtengine/downtimedetector/v1beta1/downtime_duration.proto";

option go_package = "github.com/virtengine/virtengine/sdk/go/node/downtime-detector/v1beta1";

// Query defines the gRPC querier service for the downtime detector module
service Query {
  // RecoveredSinceDowntimeOfLength queries if the chain has recovered for a specified duration
  // since experiencing downtime of a given length
  rpc RecoveredSinceDowntimeOfLength(RecoveredSinceDowntimeOfLengthRequest) returns (RecoveredSinceDowntimeOfLengthResponse) {
    option (google.api.http).get = "/virtengine/downtime-detector/v1beta1/RecoveredSinceDowntimeOfLength";
  }
}

// RecoveredSinceDowntimeOfLengthRequest is the request type for querying if the chain
// has been operational for at least the specified recovery duration since experiencing
// downtime of the specified length
message RecoveredSinceDowntimeOfLengthRequest {
  // downtime is the downtime duration to check against
  Downtime downtime = 1 [
    (gogoproto.moretags) = "yaml:\"downtime\""
  ];
  // recovery is the minimum recovery duration required since the downtime
  google.protobuf.Duration recovery = 2 [
    (gogoproto.nullable) = false,
    (gogoproto.stdduration) = true,
    (gogoproto.moretags) = "yaml:\"recovery_duration\""
  ];
}

// RecoveredSinceDowntimeOfLengthResponse is the response type for the recovery query
message RecoveredSinceDowntimeOfLengthResponse {
  // succesfully_recovered indicates if the chain has been up for at least the recovery
  // duration since the last downtime of the specified length
  bool succesfully_recovered = 1;
}
