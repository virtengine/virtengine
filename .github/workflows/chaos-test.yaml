# Copyright 2024 VirtEngine Contributors
# SPDX-License-Identifier: Apache-2.0

name: Chaos Test

on:
  schedule:
    - cron: '0 3 * * 0'  # Weekly on Sunday at 3 AM UTC
  workflow_dispatch:

jobs:
  chaos-test:
    runs-on: ubuntu-latest
    environment: chaos-test
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup kubectl
        uses: azure/setup-kubectl@v3
      
      - name: Install Chaos Mesh
        run: |
          helm repo add chaos-mesh https://charts.chaos-mesh.org
          helm install chaos-mesh chaos-mesh/chaos-mesh \
            --namespace chaos-testing --create-namespace
        continue-on-error: true
      
      - name: Apply chaos experiments
        run: |
          kubectl apply -f infra/chaos-mesh/
        continue-on-error: true
      
      - name: Cleanup
        if: always()
        run: |
          kubectl delete -f infra/chaos-mesh/ --ignore-not-found
