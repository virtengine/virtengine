# Stress Chaos Experiments for VirtEngine
# These experiments test resource exhaustion scenarios

---
# CPU Stress: Saturate CPU on validators
apiVersion: chaos-mesh.org/v1alpha1
kind: StressChaos
metadata:
  name: validator-cpu-stress
  namespace: chaos-testing
  labels:
    chaos.virtengine.io/category: stress
    chaos.virtengine.io/scenario: cpu
spec:
  mode: one
  selector:
    namespaces:
      - virtengine
    labelSelectors:
      app.kubernetes.io/component: validator
  stressors:
    cpu:
      workers: 4
      load: 80
  duration: "120s"

---
# Memory Stress: Consume memory on validators
apiVersion: chaos-mesh.org/v1alpha1
kind: StressChaos
metadata:
  name: validator-memory-stress
  namespace: chaos-testing
  labels:
    chaos.virtengine.io/category: stress
    chaos.virtengine.io/scenario: memory
spec:
  mode: one
  selector:
    namespaces:
      - virtengine
    labelSelectors:
      app.kubernetes.io/component: validator
  stressors:
    memory:
      workers: 2
      size: "512MB"
  duration: "120s"

---
# Provider CPU Stress: Stress provider daemon
apiVersion: chaos-mesh.org/v1alpha1
kind: StressChaos
metadata:
  name: provider-cpu-stress
  namespace: chaos-testing
  labels:
    chaos.virtengine.io/category: stress
    chaos.virtengine.io/scenario: cpu
spec:
  mode: one
  selector:
    namespaces:
      - virtengine
    labelSelectors:
      app.kubernetes.io/component: provider-daemon
  stressors:
    cpu:
      workers: 2
      load: 90
  duration: "180s"

---
# ML Inference Stress: Stress ML scoring containers
apiVersion: chaos-mesh.org/v1alpha1
kind: StressChaos
metadata:
  name: ml-inference-stress
  namespace: chaos-testing
  labels:
    chaos.virtengine.io/category: stress
    chaos.virtengine.io/scenario: ml
spec:
  mode: all
  selector:
    namespaces:
      - virtengine
    labelSelectors:
      app.kubernetes.io/component: ml-scorer
  stressors:
    cpu:
      workers: 4
      load: 95
    memory:
      workers: 2
      size: "1GB"
  duration: "60s"

---
# Gradual CPU Increase: Simulate gradual load increase
apiVersion: chaos-mesh.org/v1alpha1
kind: StressChaos
metadata:
  name: gradual-cpu-increase
  namespace: chaos-testing
  labels:
    chaos.virtengine.io/category: stress
    chaos.virtengine.io/scenario: gradual
spec:
  mode: all
  selector:
    namespaces:
      - virtengine
    labelSelectors:
      app.kubernetes.io/component: validator
  stressors:
    cpu:
      workers: 2
      load: 50
  duration: "300s"

---
# OOM Test: Push memory to trigger OOM
apiVersion: chaos-mesh.org/v1alpha1
kind: StressChaos
metadata:
  name: oom-test
  namespace: chaos-testing
  labels:
    chaos.virtengine.io/category: stress
    chaos.virtengine.io/scenario: oom
spec:
  mode: one
  selector:
    namespaces:
      - virtengine
    labelSelectors:
      app.kubernetes.io/component: validator
  stressors:
    memory:
      workers: 4
      size: "2GB"
      oomScoreAdj: 1000
  duration: "60s"
